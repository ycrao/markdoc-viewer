<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>MarkdocViewer</title>
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="description"
        content="markdown document viewer, reading markdown documentation from open git repository (just in one page) " />
    <meta name="author" content="https://github.com/ycrao/markdoc-viewer" />
    <link href="./css/bootstrap_mdv.css" rel="stylesheet" />
    <!-- ä½¿ç”¨CDNæœ€æ–°ç‰ˆæœ¬çš„github-markdown-css -->
    <link id="markdownCssTheme" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.8.1/github-markdown-light.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/16.3.0/lib/marked.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked-highlight/2.2.2/index.umd.min.js"></script>
    <link id="highlightJsTheme" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github.min.css" rel="stylesheet" />
    <script type="text/javascript" src="./js/markdoc_viewer.js"></script>
    <style>
        body {
            margin: 5px auto;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                Helvetica, "Hiragino Sans GB", "Microsoft Yahei", Arial, sans-serif,
                "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body.md-doc {
            max-width: none;
        }

        .docs-wrapper {
            margin: 50px 0;
        }

        strong {
            font-weight: 700;
        }

        .docs-nav {
            padding: 10px 0 10px 0;
        }

        .docs-nav ul {
            list-style-type: none;
            list-style-position: inside;
        }

        .docs-nav ul li {
            line-height: 24px;
            color: #999;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }

        .docs-nav ul li>a {
            color: #999;
            text-decoration: none;
        }

        .docs-nav ul li.active a,
        .docs-nav ul li>a:hover {
            color: #000;
        }

        .docs-nav .sider p {
            font-weight: 700;
        }

        pre {
            font-family: "Courier New", Courier, monospace;
        }

        /* ç¡®ä¿ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .dark-mode-toggle {
                top: 10px;
                right: 10px;
                padding: 6px;
                width: 38px;
                height: 38px;
                font-size: 16px;
            }
        }

        .markdown-body {
            margin-bottom: 50px !important;
        }

        /* æš—é»‘æ¨¡å¼æ ·å¼ */
        body.dark-mode {
            background-color: #0d1117;
            color: #c9d1d9;
        }

        body.dark-mode .markdown-body {
            color: #c9d1d9;
            background-color: #0d1117;
        }

        body.dark-mode .markdown-body h1,
        body.dark-mode .markdown-body h2,
        body.dark-mode .markdown-body h3,
        body.dark-mode .markdown-body h4,
        body.dark-mode .markdown-body h5,
        body.dark-mode .markdown-body h6 {
            color: #c9d1d9 !important;
            border-bottom-color: #21262d !important;
        }

        body.dark-mode .markdown-body a {
            color: #58a6ff;
        }

        body.dark-mode .markdown-body a:hover {
            color: #79c0ff;
        }

        body.dark-mode .docs-nav {
            background-color: #0d1117 !important;
            color: #c9d1d9;
        }

        body.dark-mode .docs-nav h3 {
            color: #c9d1d9;
        }

        body.dark-mode .docs-nav ul li {
            color: #8b949e;
        }

        body.dark-mode .docs-nav ul li>a {
            color: #8b949e;
        }

        body.dark-mode .docs-nav ul li.active a,
        body.dark-mode .docs-nav ul li>a:hover {
            color: #c9d1d9;
        }

        body.dark-mode .bg-info {
            background-color: #0d1117 !important;
        }

        body.dark-mode .table-bordered {
            border-color: #30363d;
        }

        body.dark-mode .table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(240, 246, 252, 0.05);
        }

        body.dark-mode .markdown-body table th,
        body.dark-mode .markdown-body table td {
            border-color: #30363d;
        }

        body.dark-mode .markdown-body table tr {
            background-color: #0d1117;
            border-top-color: #30363d;
        }

        body.dark-mode .markdown-body table tr:nth-child(2n) {
            background-color: #161b22;
        }

        body.dark-mode pre {
            background-color: #161b22;
            border-color: #30363d;
        }

        body.dark-mode code {
            /*background-color: rgba(240, 246, 252, 0.15);*/
            color: #c9d1d9;
        }

        body.dark-mode blockquote {
            color: #8b949e;
            border-left-color: #3fb950;
            background-color: #161b22;
        }

        body.dark-mode .markdown-body img {
            background-color: transparent;
        }

        /* æš—é»‘æ¨¡å¼åˆ‡æ¢æŒ‰é’® */
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 10px;
            background-color: #f6f8fa;
            border: 1px solid #d1d9e0;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .dark-mode-toggle {
            background-color: #21262d;
            border-color: #30363d;
            color: #c9d1d9;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .dark-mode-toggle:hover {
            background-color: #e9ecef;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        body.dark-mode .dark-mode-toggle:hover {
            background-color: #30363d;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }

        .dark-mode-icon {
            transition: transform 0.3s ease;
        }

        .dark-mode-toggle:hover .dark-mode-icon {
            transform: rotate(180deg);
        }

        /* åŠ è½½æŒ‡ç¤ºå™¨æ ·å¼ */
        .loading-indicator {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        body.dark-mode .loading-indicator {
            color: #8b949e;
        }

        body.dark-mode .spinner {
            border-color: #21262d;
            border-top-color: #58a6ff;
        }
    </style>
</head>

<body>
    <!-- æš—é»‘æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
    <button class="dark-mode-toggle" id="darkModeToggle" title="åˆ‡æ¢æš—é»‘æ¨¡å¼">
        <span class="dark-mode-icon" id="darkModeIcon">ğŸŒ™</span>
    </button>

    <div class="docs-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-md-7 col-sm-6">
                    <div class="loading-indicator" id="loadingIndicator" style="display: none;">
                        <div class="spinner"></div>
                        <p>æ­£åœ¨åŠ è½½æ–‡æ¡£...</p>
                    </div>
                    <article class="markdown-body" id="content">
                        <!-- md_doc_body -->
                    </article>
                </div>
                <div class="col-lg-4 col-md-5 col-sm-6">
                    <div class="docs-nav bg-info">
                        <h3>ç›®å½•</h3>
                        <section id="sider-menu">
                            <!-- md_doc_nav -->
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const dir = config("dir", ""),
            repo = config("repo", "ycrao/mynotes"),
            branch = config("branch", "master"),
            index = config("index", "index.md"),
            home = config("home", "intro.md");
        const options = {
            base_url: "https://raw.githubusercontent.com/",
            base_dir: dir,
            repo_name: repo,
            branch_name: branch,
            index_file: index,
            home_file: home,
            sider_id: "sider-menu",
            content_id: "content",
        };
        // æš—é»‘æ¨¡å¼åˆ‡æ¢åŠŸèƒ½
        function toggleDarkMode() {
            const body = document.body;
            const darkModeIcon = document.getElementById('darkModeIcon');
            const isDarkMode = body.classList.contains('dark-mode');
            const themeLink = document.getElementById('highlightJsTheme');
            const markdownCssLink = document.getElementById('markdownCssTheme');

            if (isDarkMode) {
                body.classList.remove('dark-mode');
                darkModeIcon.textContent = 'ğŸŒ™';
                localStorage.setItem('darkMode', 'false');
                themeLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github.min.css';
                markdownCssLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.8.1/github-markdown-light.min.css';
            } else {
                body.classList.add('dark-mode');
                darkModeIcon.textContent = 'â˜€ï¸';
                localStorage.setItem('darkMode', 'true');
                themeLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github-dark.min.css';
                markdownCssLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.8.1/github-markdown-dark.min.css';
            }
        }

        // åˆå§‹åŒ–æš—é»‘æ¨¡å¼
        function initDarkMode() {
            const savedMode = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const themeLink = document.getElementById('highlightJsTheme');
            const markdownCssLink = document.getElementById('markdownCssTheme');

            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨æˆ–ç³»ç»Ÿåå¥½
            if (savedMode === 'true' || (savedMode === null && prefersDark)) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeIcon').textContent = 'â˜€ï¸';
                themeLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github-dark.min.css';
                markdownCssLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.8.1/github-markdown-dark.min.css';
            }
        }

        // ç»‘å®šåˆ‡æ¢æŒ‰é’®äº‹ä»¶
        document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initDarkMode);

        var mv = new MarkdocViewer(options);
        mv.viewer();

        // highlight sider menu
        setTimeout(function () {
            var href = "?doc=" + request("doc");
            var sider = mv.options["sider_id"];
            // $('#' + sider + ' li').find('a[href="' + href + '"]').closest('li').addClass('active');
            var targetLi = document.querySelector(
                "#" + sider + ' li a[href="' + href + '"]'
            );
            if (targetLi != null && targetLi.parentElement != null) {
                targetLi.parentElement.setAttribute("class", "active");
            }
        }, 1000);

        // å…¨å±€æ•è·å›¾ç‰‡åŠ è½½é”™è¯¯äº‹ä»¶
        document.addEventListener('error', function(e) {
            if (e.target.tagName.toLowerCase() === 'img') {
                const originalSrc = e.target.getAttribute('src') || '';
                if (originalSrc.startsWith('data:') || originalSrc.startsWith('http')) {
                    // å¿½ç•¥ data URI å›¾ç‰‡
                    return;
                } else {
                    // å¤„ç†ç›¸å¯¹è·¯å¾„å›¾ç‰‡åŠ è½½å¤±è´¥
                    e.target.setAttribute('data-original-src', originalSrc);
                    const baseUrl = mv.baseDirUrl;
                    // æ›¿æ¢ä¸ºç»å¯¹è·¯å¾„é‡æ–°åŠ è½½
                    e.target.src = baseUrl + originalSrc;
                }
            }
        }, true);
    </script>
</body>

</html>